extends ../../../views/layout

block content
  - const hasFavorites = Array.isArray(favorites) && favorites.length > 0;

  div(class="space-y-6")
    header(class="bg-white rounded-3xl shadow-sm ring-1 ring-gray-200 p-6 flex flex-col gap-4 md:flex-row md:items-start md:justify-between")
      div(class="space-y-3")
        div(class="flex items-center gap-3 text-xs font-semibold uppercase tracking-wide text-purple-700")
          span(class="inline-flex items-center px-3 py-1 rounded-full bg-purple-100 text-purple-700")
            i(data-lucide="heart" class="w-3 h-3 mr-1")
            | Saved creators
          if hasFavorites
            span(class="inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-700") #{favorites.length} favourites
          else
            span(class="inline-flex items-center px-3 py-1 rounded-full bg-gray-100 text-gray-500") None yet
        h1(class="text-3xl font-semibold text-gray-900") Favourite Influencers
        p(class="text-gray-600 max-w-2xl") Fine-tune your shortlist of creators for #{(currentEntity && currentEntity.name) || 'your brand'}. Export the list for sharing or remove names that no longer align with campaign goals.
      div(class="flex flex-col items-start gap-3 md:items-end w-full md:w-auto")
        if feedback && feedback.status
          div(class=[
            'rounded-2xl px-4 py-3 border text-sm max-w-md md:max-w-xs',
            feedback.status === 'error' ? 'bg-red-50 border-red-200 text-red-700' : 'bg-emerald-50 border-emerald-200 text-emerald-700'
          ])
            span #{feedback.message || (feedback.status === 'error' ? 'Unable to complete the requested action.' : 'Action completed successfully.')}
        a(href="/echo/favorites/export" class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-purple-600 text-white text-sm font-medium shadow-sm hover:bg-purple-700 transition")
          i(data-lucide="download" class="w-4 h-4")
          | Export CSV

    if hasFavorites
      div(class="bg-white rounded-3xl shadow-sm ring-1 ring-gray-200 overflow-hidden")
        div(class="overflow-auto")
          table(class="min-w-full divide-y divide-gray-200 text-sm text-gray-700")
            thead(class="bg-gray-50 text-gray-500 uppercase text-xs tracking-wide")
              tr
                th(class="px-6 py-3 text-left") Influencer
                th(class="px-6 py-3 text-left") Platforms
                th(class="px-6 py-3 text-left") Engagement
                th(class="px-6 py-3 text-left") Reach
                th(class="px-6 py-3 text-left") Fit Score
                th(class="px-6 py-3 text-left") Rationale
                th(class="px-6 py-3 text-right") Actions
            tbody(class="divide-y divide-gray-100 bg-white")
              each favorite in favorites
                - const influencer = favorite.influencer || {};
                - const engagement = typeof favorite.engagement === 'number' ? (favorite.engagement * 100).toFixed(1) + '%' : '—';
                - const reach = typeof favorite.reach === 'number' ? favorite.reach : null;
                - const reachDisplay = reach === null ? '—' : (reach >= 1_000_000 ? (reach / 1_000_000).toFixed(1) + 'M' : reach >= 1_000 ? Math.round(reach / 1000) + 'k' : reach);
                - const platforms = favorite.platforms || [];
                - const contact = influencer.contactEmail ? `mailto:${influencer.contactEmail}` : null;
                tr(class="hover:bg-gray-50 transition")
                  td(class="px-6 py-4 align-top")
                    div(class="flex items-start gap-3")
                      if influencer.profileImage
                        img(src=influencer.profileImage alt=influencer.name class="w-10 h-10 rounded-full object-cover border border-gray-200 mt-0.5")
                      div
                        p(class="font-medium text-gray-900") #{influencer.name || 'Unknown creator'}
                        if influencer.handle
                          p(class="text-xs text-gray-500") @#{influencer.handle}
                  td(class="px-6 py-4 align-top text-gray-600")
                    if platforms.length
                      span(class="inline-flex flex-wrap gap-1")
                        each platform in platforms
                          span(class="inline-flex items-center px-2 py-1 rounded-full bg-gray-100 text-xs font-medium capitalize text-gray-700") #{platform}
                    else
                      span(class="text-xs text-gray-400") No data
                  td(class="px-6 py-4 align-top text-gray-600") #{engagement}
                  td(class="px-6 py-4 align-top text-gray-600") #{reachDisplay}
                  td(class="px-6 py-4 align-top text-gray-600") #{typeof favorite.score === 'number' ? Math.round(favorite.score) : '—'}
                  td(class="px-6 py-4 align-top text-gray-600") #{favorite.rationale || '—'}
                  td(class="px-6 py-4 align-top text-right")
                    div(class="flex items-center justify-end gap-2")
                      if contact
                        a(href=contact class="text-xs text-purple-600 hover:text-purple-500 inline-flex items-center gap-1")
                          i(data-lucide="mail" class="w-3 h-3")
                          | Contact
                      form(method="post" action=`/echo/favorites/${influencer.id || favorite.influencer_id || favorite.influencerId}` class="inline-flex")
                        input(type="hidden" name="isFavorite" value="false")
                        input(type="hidden" name="redirectTo" value="/echo/favorites")
                        button(type="submit" class="px-3 py-1.5 text-xs rounded-lg font-medium transition bg-red-100 text-red-600 hover:bg-red-200 inline-flex items-center gap-1")
                          i(data-lucide="x" class="w-3 h-3")
                          | Remove
    else
      div(class="bg-white rounded-3xl shadow-sm ring-1 ring-gray-200 p-8 text-center text-sm text-gray-500")
        p No favourites yet. Visit the matches table to identify promising creators and add them here.
        a(href="/echo/matches" class="mt-3 inline-flex items-center justify-center px-4 py-2 rounded-lg bg-purple-600 text-white text-sm font-medium shadow-sm hover:bg-purple-700 transition")
          i(data-lucide="arrow-right" class="w-4 h-4 mr-2")
          | Browse matches

  script(src="https://unpkg.com/lucide@latest/dist/umd/lucide.js")
  script.
    lucide.createIcons();
