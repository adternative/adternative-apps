extends frame

block pageContent
  // Header
  div(class="mb-8")
    h2(class="text-2xl font-bold text-gray-900") Demographics
    p(class="text-gray-600") Define your audience and preferences for better targeting

  // Create Demographic widget (add new)
  div(class="bg-white rounded-xl shadow p-6 mb-8")
    h3(class="text-lg font-semibold text-gray-900 mb-4") Add demographic
    form(action="/demographics" method="POST" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4")
      // Name
      div(class="md:col-span-2 lg:col-span-3")
        label(for="dg_name" class="block text-sm font-medium text-gray-700 mb-2") Name
        input(type="text" id="dg_name" name="name" placeholder="Name of the targeted demographic" class="w-full px-4 py-3 text-xl border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent" required)

      div(class="grid grid-cols-3 gap-4")
        div
          label(for="dg_gender" class="block text-sm font-medium text-gray-700 mb-2") Gender
          select(id="dg_gender" name="gender" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent")
            option(value="male") Male
            option(value="female") Female
            option(value="other") Other
        div
          label(for="dg_age_min" class="block text-sm font-medium text-gray-700 mb-2") Age min
          input(type="number" id="dg_age_min" name="age_min" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent")
        div
          label(for="dg_age_max" class="block text-sm font-medium text-gray-700 mb-2") Age max
          input(type="number" id="dg_age_max" name="age_max" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent")
      
      div(class="grid grid-cols-4 gap-4")
        div(class="col-span-1")
          label(for="dg_country" class="block text-sm font-medium text-gray-700 mb-2") Country
          select(id="dg_country" name="country" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent")
            option(value="") Select
            option(value="RO") ðŸ‡·ðŸ‡´ RO
        div(class="col-span-1")
          label(for="dg_language" class="block text-sm font-medium text-gray-700 mb-2") Language
          select(id="dg_language" name="language" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent")
            option(value="") Select
            option(value="ro") ðŸ‡·ðŸ‡´ RO
            option(value="en") ðŸ‡¬ðŸ‡§ EN
            option(value="de") ðŸ‡©ðŸ‡ª DE 
        div(class="col-span-2")
          label(for="dg_city" class="block text-sm font-medium text-gray-700 mb-2") City
          input(type="text" id="dg_city" name="city" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent")

      div(class="grid grid-cols-2 gap-4")
        div(class="col-span-1")
          label(for="dg_income_min" class="block text-sm font-medium text-gray-700 mb-2") Income min
          input(type="number" id="dg_income_min" name="income_min" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent")
        div(class="col-span-1")
          label(for="dg_income_max" class="block text-sm font-medium text-gray-700 mb-2") Income max
          input(type="number" id="dg_income_max" name="income_max" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent")


      // Interests
      div(class="md:col-span-2 lg:col-span-3")
        label(for="dg_interests_editor" class="block text-sm font-medium text-gray-700 mb-2") Interests
        // Hidden field that will carry comma-separated values
        input(type="hidden" id="dg_interests" name="interests")
        // Tag editor box styled like inputs; type comma or Enter to add
        div(id="dg_interests_tagbox" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus-within:ring-2 focus-within:ring-purple-500 focus-within:border-transparent min-h-[42px] flex flex-wrap items-center gap-2")
          // Tags will be injected here
          input(type="text" id="dg_interests_editor" placeholder="Type interest and press Enter or ," class="flex-1 min-w-[140px] outline-none text-sm bg-transparent")

      // Submit button
      div(class="md:col-span-2 lg:col-span-3 flex justify-end mt-2")
        button(type="submit" class="inline-flex items-center justify-center px-4 py-2 rounded-lg font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 bg-teal-400 text-white hover:bg-purple-900 focus:ring-purple-500")
          i(data-lucide="save" class="w-4 h-4 mr-2")
          | Add demographic

  // Demographics table
  div(class="bg-white rounded-xl shadow overflow-hidden")
    div(class="px-6 py-4 border-b border-gray-200 flex items-center justify-between")
      h3(class="text-lg font-semibold text-gray-900") Current demographics
    if demographics && demographics.length
      div(class="overflow-x-auto")
        table(class="min-w-full divide-y divide-gray-200")
          thead(class="bg-gray-50")
            tr
              th(class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider") Name
              th(class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider") Age Range
              th(class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider") Gender
              th(class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider") Location
              th(class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider") Language
              th(class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider") Income
              th(class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider") Interests
          tbody(class="bg-white divide-y divide-gray-200")
            each d in demographics
              - var ar = (d && d.age_range) ? d.age_range : {};
              - var loc = (d && d.location) ? d.location : {};
              - var inc = (d && d.income) ? d.income : {};
              - var gens = (d && d.gender) ? d.gender : [];
              - var ints = (d && d.interests) ? d.interests : [];
              tr
                td(class="px-6 py-4 whitespace-nowrap text-sm text-gray-900")= d.name
                td(class="px-6 py-4 whitespace-nowrap text-sm text-gray-700")= (ar.min || ar.max) ? `${ar.min || '-'} - ${ar.max || '-'}` : '-'
                td(class="px-6 py-4 whitespace-nowrap text-sm text-gray-700")= (Array.isArray(gens) && gens.length) ? gens.join(', ') : '-'
                td(class="px-6 py-4 whitespace-nowrap text-sm text-gray-700")= (loc.country || loc.city) ? `${loc.country || ''}${loc.country && loc.city ? ', ' : ''}${loc.city || ''}` : '-'
                td(class="px-6 py-4 whitespace-nowrap text-sm text-gray-700")= d.language || '-'
                td(class="px-6 py-4 whitespace-nowrap text-sm text-gray-700")= (inc.min || inc.max) ? `${inc.min || '-'} - ${inc.max || '-'}` : '-'
                td(class="px-6 py-4 whitespace-nowrap text-sm text-gray-700")= (Array.isArray(ints) && ints.length) ? ints.join(', ') : '-'
    else
      div(class="px-6 py-6 text-gray-600") No demographics yet.


