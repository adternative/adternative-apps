doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    title= title
    link(rel="icon" href="https://adternative.ro/wp-content/themes/_unordinary/assets/logo.png" type="image/png")
    link(rel='stylesheet', href='/stylesheets/dist.css')
    script(src="https://unpkg.com/lucide@latest/dist/umd/lucide.js")
  body(class="min-h-screen bg-purple-950 flex flex-col")
    - var noEntities = typeof noEntities !== 'undefined' ? noEntities : ((typeof user !== 'undefined' && user && user.entities && user.entities.length === 0) ? true : false)
    // Top navbar - always visible
    nav(class="fixed top-0 left-0 right-0 z-50 bg-zinc-900/80 shadow-lg backdrop-blur-lg px-6 py-3 mb-0" + (noEntities ? ' hidden' : ''))
      div(class="flex justify-between items-center")
        div(class="flex items-center space-x-4")
          // Mobile menu button (only show for authenticated users)
          if user
            button(id="mobileMenuBtn" class="lg:hidden text-gray-500 hover:text-gray-700")
              i(data-lucide="menu" class="w-6 h-6")
          
          // Search bar
          div(class="relative")
            input(type="text" placeholder="Search..." class="block w-full rounded-none bg-transparent border-b-2 border-teal-400 px-3 py-1.5 text-base text-teal-400 outline-none placeholder:text-teal-400 focus:outline-none focus:border-teal-400 sm:text-sm/6")
        
        div(class="flex items-center space-x-4")
          if user
            // User dropdown menu
            div(class="relative")
              button(id="userDropdownBtn" class="flex items-center space-x-3 px-3 py-2 rounded-lg hover:bg-purple-900 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500")
                // User avatar
                div(class="w-8 h-8 bg-teal-400 rounded-full flex items-center justify-center text-white font-semibold text-sm p-3" )
                  = user.first_name ? user.first_name.charAt(0).toUpperCase() + user.last_name.charAt(0).toUpperCase() : 'U'
                // User name
                span(class="text-sm font-medium text-teal-400")= user.first_name + ' ' + user.last_name || 'User'
                // Dropdown arrow
                i(data-lucide="chevron-down" class="w-4 h-4 text-teal-400")
              
              // Dropdown menu
              div(id="userDropdown" class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-50 hidden")
                a(href="/settings" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors duration-200")
                  i(data-lucide="settings" class="w-4 h-4 mr-3 text-gray-400")
                  | Settings
                a(href="/billing" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors duration-200")
                  i(data-lucide="credit-card" class="w-4 h-4 mr-3 text-gray-400")
                  | Billing
                hr(class="my-1 border-gray-200")
                button(id="logoutBtn" class="flex items-center w-full px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors duration-200")
                  i(data-lucide="log-out" class="w-4 h-4 mr-3")
                  | Logout
          else
            // Login/Register buttons for unauthenticated users
            a(href="/login" class="inline-flex items-center justify-center px-4 py-2 rounded-lg font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500") Login
            a(href="/register" class="inline-flex items-center justify-center px-4 py-2 rounded-lg font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 bg-gray-200 text-gray-800 hover:bg-gray-300 focus:ring-gray-500") Register

    // Main content area
    main(class="flex-1 pt-24 overflow-y-auto min-h-0" + (noEntities ? ' hidden' : ''))
      // Mobile overlay
      div(id="mobileOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden hidden")
      
      // Sidebar + main content layout
      div(class="flex h-full min-h-screen")
        // Sidebar - Dark design with fixed user section
        div(id="sidebar" class="lg:relative inset-y-0 left-0 z-20 w-72 bg-purple-950 flex flex-col transform -translate-x-full lg:translate-x-0 transition-all duration-300 ease-in-out h-screen lg:h-full")
          // Mobile close button
          div(class="lg:hidden flex justify-end p-6")
            button(id="closeSidebarBtn" class="text-slate-400 hover:text-white transition-colors")
              i(data-lucide="x" class="w-6 h-6")

          // Sidebar title with Entity selector
          if user
            div(class="px-6 pb-6 pt-1 border-b border-purple-900")
              div(class="relative")
                button(id="entityDropdownBtn" class="flex items-center justify-between w-full px-3 py-2 rounded-lg hover:bg-purple-900 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-teal-500")
                  // Current entity name with icon
                  div(class="flex items-center space-x-4")
                    // Entity avatar/image
                    div(class="w-12 h-12 bg-purple-900 rounded-full flex items-center justify-center text-white font-semibold")
                      i(data-lucide="briefcase" class="text-xl m-4")
                    span(id="currentEntityName" class="text-base text-lg text-teal-400")= (typeof selectedEntityName !== 'undefined' && selectedEntityName) ? selectedEntityName : 'Select Entity'
                  // Dropdown arrow
                  i(data-lucide="chevron-down" class="w-4 h-4 text-teal-400")
                
                // Dropdown menu
                div(id="entityDropdown" class="absolute left-0 mt-2 w-72 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-50 hidden")
                  if user.entities && user.entities.length > 0
                    each entity in user.entities
                      button(data-entity-id=entity.id data-entity-name=entity.name class="flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors duration-200 entity-item")
                        div(class="w-8 h-8 bg-teal-400 rounded-lg flex items-center justify-center text-white font-semibold text-xs mr-3")
                          i(data-lucide="building" class="w-4 h-4")
                        span(class="font-medium")= entity.name
                    hr(class="my-1 border-gray-200")
                  button(id="addEntityBtn" class="flex items-center w-full px-4 py-2 text-sm text-teal-600 hover:bg-teal-50 transition-colors duration-200")
                    i(data-lucide="plus" class="w-4 h-4 mr-3")
                    | Add Entity
                  

          // Navigation sections - scrollable area with fixed height
          nav(class="flex-1 px-6 py-6 space-y-8 h-full")
            // Pages Section
            div
              div(class="space-y-1")
                a(href="/" class="group flex items-center px-4 py-3 rounded-xl text-teal-400 hover:text-white hover:bg-purple-900 transition-all duration-200" + (title === 'Overview' ? ' bg-purple-900 text-white' : ''))
                  span(class="font-medium") Overview
                a(href="/analytics" class="group flex items-center px-4 py-3 rounded-xl text-teal-400 hover:text-white hover:bg-purple-900 transition-all duration-200" + (title === 'Analytics' ? ' bg-purple-900 text-white' : ''))
                  span(class="font-medium") Analytics
                a(href="/finance" class="group flex items-center px-4 py-3 rounded-xl text-teal-400 hover:text-white hover:bg-purple-900 transition-all duration-200" + (title === 'Finance' ? ' bg-purple-900 text-white' : ''))
                  span(class="font-medium") Finance
                a(href="/media" class="group flex items-center px-4 py-3 rounded-xl text-teal-400 hover:text-white hover:bg-purple-900 transition-all duration-200" + (title === 'Media' ? ' bg-purple-900 text-white' : ''))
                  span(class="font-medium") Media
                a(href="/performance" class="group flex items-center px-4 py-3 rounded-xl text-teal-400 hover:text-white hover:bg-purple-900 transition-all duration-200" + (title === 'Performance' ? ' bg-purple-900 text-white' : ''))
                  span(class="font-medium") Reports
            
            // Apps Section
            if availableApps && availableApps.length > 0
              div
                h3(class="text-xs font-semibold text-slate-400 uppercase tracking-wider mb-4 flex items-center")
                  | Apps
                div(class="space-y-1")
                  each app in availableApps
                    - var isActiveApp = (typeof appName !== 'undefined' ? appName === app.name : (title && title.startsWith(app.name)) )
                    a(href=app.path class="group flex items-center px-4 py-3 rounded-xl  text-teal-400 hover:text-white hover:bg-purple-900 transition-all duration-200" + (isActiveApp ? ' bg-purple-900 text-white' : ''))
                      i(data-lucide=app.icon class="w-5 h-5 mr-3 group-hover:scale-110 transition-transform" + (isActiveApp ? ' text-white' : ' text-teal-400'))
                      span(class="font-medium")=app.name
                    if isActiveApp && app.links && app.links.length
                      div(class="mt-1 space-y-1 pl-8")
                        each link in app.links
                          a(href=app.path + link.url class="block px-4 py-2 rounded-lg text-teal-400 hover:text-white hover:bg-purple-900 text-md transition-colors")= link.name

        // Page content - positioned to the right of sidebar
        div(class="flex-1 min-h-0 bg-purple-50 rounded-tl-3xl")
          div(class="p-8")
            block content

    script(src="/javascripts/app.js")
    // Expose selected entity to client to initialize localStorage on first load
    if typeof selectedEntityId !== 'undefined'
      script.
        window.__SELECTED_ENTITY_ID__ = '!{selectedEntityId}';
        try { if (!localStorage.getItem('currentEntityId') && window.__SELECTED_ENTITY_ID__) { localStorage.setItem('currentEntityId', window.__SELECTED_ENTITY_ID__); } } catch (e) {}
    script.
      lucide.createIcons();
    // Global Create Entity Modal (available across all pages)
    if user
      - var modalOverlayClass = noEntities ? 'fixed inset-0 z-50 bg-purple-950' : 'fixed inset-0 bg-gray-600 bg-opacity-50 z-50 hidden'
      div(id="globalCreateEntityModal" class=modalOverlayClass)
        div(class="flex items-center justify-center min-h-screen p-4")
          div(class="bg-white rounded-lg shadow-xl max-w-md w-full")
            div(class="p-6")
              div(class="flex justify-between items-center mb-4")
                h3(class="text-lg font-medium text-gray-900") Create New Entity
                if !noEntities
                  button(id="globalCloseEntityModalBtn" class="inline-flex items-center justify-center text-gray-400 hover:text-gray-600")
                    i(data-lucide="x" class="w-5 h-5")
              form(id="globalCreateEntityForm")
                div(class="space-y-4")
                  div
                    label(for="ge_name" class="block text-sm font-medium text-gray-700 mb-2") Entity Name
                    input(type="text" id="ge_name" name="name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required)
                  div
                    label(for="ge_industry" class="block text-sm font-medium text-gray-700 mb-2") Industry
                    select(id="ge_industry" name="industry" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required)
                      option(value="") Select an industry
                      option(value="Advertising & Marketing") Advertising & Marketing
                      option(value="Technology") Technology
                      option(value="E-commerce") E-commerce
                      option(value="Finance") Finance
                      option(value="Healthcare") Healthcare
                      option(value="Education") Education
                      option(value="Real Estate") Real Estate
                      option(value="Retail") Retail
                      option(value="Hospitality") Hospitality
                      option(value="Travel & Tourism") Travel & Tourism
                      option(value="Media & Entertainment") Media & Entertainment
                      option(value="Manufacturing") Manufacturing
                      option(value="Nonprofit") Nonprofit
                      option(value="Automotive") Automotive
                      option(value="Consumer Goods") Consumer Goods
                      option(value="Energy") Energy
                      option(value="Telecommunications") Telecommunications
                      option(value="Government") Government
                      option(value="Legal") Legal
                      option(value="Logistics & Transportation") Logistics & Transportation
                      option(value="Construction") Construction
                      option(value="Agriculture") Agriculture
                      option(value="Food & Beverage") Food & Beverage
                      option(value="Pharmaceuticals") Pharmaceuticals
                      option(value="Sports & Recreation") Sports & Recreation
                      option(value="Fashion & Apparel") Fashion & Apparel
                  div
                    label(for="ge_description" class="block text-sm font-medium text-gray-700 mb-2") Description (Optional)
                    textarea(id="ge_description" name="description" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent" rows="3")
                  div
                    label(for="ge_website" class="block text-sm font-medium text-gray-700 mb-2") Website (Optional)
                    input(type="url" id="ge_website" name="website" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent")
              
                div(class="flex justify-end space-x-3 mt-6")
                  if !noEntities
                    button(type="button" id="globalCancelEntityBtn" class="inline-flex items-center justify-center px-4 py-2 rounded-lg font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 bg-gray-200 text-gray-800 hover:bg-gray-300 focus:ring-gray-500") Cancel
                  button(type="submit" class="inline-flex items-center justify-center px-4 py-2 rounded-lg font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 bg-teal-400 text-white hover:bg-purple-900 focus:ring-purple-500") Create Entity

              

      
